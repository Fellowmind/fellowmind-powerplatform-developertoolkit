var executionContext,fmfi=window.fmfi||{},JsLib=fmfi.PowerPlatform?.DeveloperToolkit?.JsLib;fmfi.JsComponents=fmfi.JsComponents||{},fmfi.JsComponents._JsLibMinPath="/WebResources/fmfi_/Fellowmind.PowerPlatform.DeveloperToolkit.JS/fmfi.PowerPlatform.DeveloperToolkit.JsLib.min.js",fmfi.JsComponents._LocalizationFileName="fmfi_/Fellowmind.PowerPlatform.DeveloperToolkit.JS/strings/fmfi.JsComponents",fmfi.JsComponents.Helpers=fmfi.JsComponents.Helpers||function(){let e;return{JSLIBLoader:{Load:async function(){if(null==JsLib&&fmfi.PowerPlatform?.DeveloperToolkit?.JsLib){JsLib=fmfi.PowerPlatform?.DeveloperToolkit?.JsLib;return}if(!e){var o;e=(o=fmfi.JsComponents._JsLibMinPath,new Promise(function(e,i){var t=document.createElement("script");t.type="text/javascript",t.src=o,t.async=!0,t.onload=function(){return e()},t.onerror=function(){return i(Error("Failed to load depend library from "+o))},document.head.appendChild(t)})).finally(()=>{e=void 0})}null==JsLib&&(await e,JsLib=fmfi.PowerPlatform.DeveloperToolkit.JsLib)}},Common:{ConvertFieldValueToStringArray:function(e){if(JsLib.Helper.IsNullOrUndefined(e))return[""];if(!Array.isArray(e))return[e.toString().toLowerCase()];{let o=e;return o.length>0&&"object"==typeof o[0]&&!Array.isArray(o[0])&&null!==o[0]?o=o.map(e=>JsLib.Helper.RemoveParenthesisFromGUID(e.id).toLowerCase()):o.length>0&&"object"!=typeof o[0]&&!Array.isArray(o[0])&&null!==o[0]?o=o.map(e=>JsLib.Helper.RemoveParenthesisFromGUID(e.toString()).toLowerCase()):(0===o.length||1===o.length&&null===o[0])&&(o=[""]),o}},ParseSettings:function(e,o){let i;try{i=JSON.parse(e)}catch(t){let n=Error("Error when parsing JSON. \nJSON must be inside single quation marks! \nExample: '"+o);throw fmfi.JsComponents.Helpers.Common.ShowError(n),n}if(JsLib.Helper.IsNullOrUndefined(i)||Array.isArray(JSON.parse(o))&&i.length<=0){let r=Error("Settings array missing or empty from JSON. \nExample: '"+o+"'");throw fmfi.JsComponents.Helpers.Common.ShowError(r),r}return i},CreateError:function(e,o){let i=o.name+" "+(e.message??e),t=" \n";return JsLib.Helper.IsNullOrUndefined(o.JSONModel)||(t+="Example: '"+o.JSONModel+"' \n"),Error(i+t)},ShowError:function(e,o,i){let t=o+" "+(e.message??e),n=e.stack??e.raw,r=t+" \n";JsLib.Helper.IsNullOrUndefined(i)||(r+="Example: '"+i+"' \n"),Xrm.Navigation.openErrorDialog({message:t,details:r+n})},CalculateDialogDimension(e){let o={height:null,width:null};return!JsLib.Helper.IsNullOrUndefined(e)&&(e.length>100||e.split("\n").length>=3)&&(o={height:Math.max(e.length/70*20*(e.split("\n").length+1)+100,150),width:450}),o}}}}(),fmfi.JsComponents.FormLocker=fmfi.JsComponents.FormLocker||function(){let e={name:"FormLocker",JSONModel:'{"lookupFieldToParentTable":"FIELD_SCHEMA_NAME", "sourceField": "FIELD_SCHEMA_NAME", "lockingValues": ["FIELD_VALUE"], "reverseLockingValues": false, "exceptionFields": ["FIELD_SCHEMA_NAME"]}'},o=function(o){if(JsLib.Helper.IsNullOrUndefined(o.sourceField))throw fmfi.JsComponents.Helpers.Common.CreateError("sourceField missing from the Settings JSON",e);if(JsLib.Helper.IsNullOrUndefined(o.lockingValues)||o.lockingValues.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError("lockingValues missing or array empty from the Settings JSON",e);o.lockingValues=o.lockingValues.map(e=>JsLib.Helper.IsNullOrUndefined(e)?"":JsLib.Helper.RemoveParenthesisFromGUID(e.toString()).toLowerCase()),JsLib.Helper.IsNullOrUndefined(o.exceptionFields)&&(o.exceptionFields=[]),JsLib.Helper.IsNullOrUndefined(o.reverseLockingValues)&&(o.reverseLockingValues=!1)},i=async function(o){let i;if(JsLib.Helper.IsNullOrUndefined(o.lookupFieldToParentTable))i=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(JsLib.UI.Field.GetValue(o.sourceField));else{let t=JsLib.UI.Field.GetValue(o.lookupFieldToParentTable);if(JsLib.Helper.IsNullOrUndefined(t))return;let n=await JsLib.WebAPI.CRUD.RetrieveByIDSync(t[0].entityType,t[0].id,"?$select="+o.sourceField).catch(o=>{fmfi.JsComponents.Helpers.Common.ShowError(o,e.name)});i=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(n[o.sourceField])}if(JsLib.Helper.IsNullOrUndefined(i))return;let r=i.some(e=>o.lockingValues.includes(e));(o.reverseLockingValues?!r:r)&&JsLib.UI.Form.SetFormFieldsState(!1,o.exceptionFields)};return{BasedOnFieldValue:{OnLoad:async function(t,n){if(!t)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',e);if(executionContext=t,!n)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',e);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();let r=fmfi.JsComponents.Helpers.Common.ParseSettings(n,e.JSONModel);o(r);let s=r.sourceField;JsLib.Helper.IsNullOrUndefined(r.lookupFieldToParentTable)||(s=r.lookupFieldToParentTable),JsLib.UI.Listeners.Field.RegisterOnChangeEvent(s,function(){JsLib.UI.Form.IsDirty()?JsLib.Record.Save(void 0,function(){JsLib.UI.Form.GetCurrentForm().navigate()},function(){}):JsLib.UI.Form.GetCurrentForm().navigate()}),i(r).catch(o=>{fmfi.JsComponents.Helpers.Common.ShowError(o,e.name,e.JSONModel)})}}}}(),fmfi.JsComponents.FormSwitch=fmfi.JsComponents.FormSwitch||function(){let e=function(e,o){if(JsLib.Helper.IsNullOrUndefined(e.sourceField))throw fmfi.JsComponents.Helpers.Common.CreateError("sourceField missing from the Settings JSON",o);if(JsLib.Helper.IsNullOrUndefined(e.fieldSettings))throw fmfi.JsComponents.Helpers.Common.CreateError("fieldSettings missing or empty from the Settings JSON",o);for(let[i,t]of(JsLib.Helper.IsNullOrUndefined(e.switchIfNewForm)&&(e.switchIfNewForm=!0),Object.entries(e.fieldSettings))){if(JsLib.Helper.IsNullOrUndefined(t))throw fmfi.JsComponents.Helpers.Common.CreateError("Form GUID is empty or invalid in the Settings JSON",o);e.fieldSettings[i]=JsLib.Helper.RemoveParenthesisFromGUID(t.toString()).toLowerCase()}},o=function(){let e={},o=JsLib.Record.GetRecordAttributes().get();if(null!=o)for(let i in o)o[i].getIsDirty()&&o[i].getValue()?(e[o[i].getName()]=o[i].getValue(),o[i].setSubmitMode(JsLib.Enums.Field_SubmitModes.NEVER)):o[i].getIsDirty()&&o[i].setSubmitMode(JsLib.Enums.Field_SubmitModes.NEVER);return e},i=async function(e){if(!e.switchIfNewForm&&JsLib.UI.Form.GetType()===JsLib.Enums.FormType.CREATE)return;let i=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(JsLib.UI.Field.GetValue(e.sourceField)),t=JsLib.UI.Form.GetCurrentForm();i.every(function(i){i=0!==i.length?i:"null";let n=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(e.fieldSettings[i]),r=n.some(e=>e===t.getId().toLowerCase());if(r)return!1;JsLib.UI.Form.GetCurrentEntityAllForms().forEach(function(e){let i=n.some(o=>o===e.getId().toLowerCase());i&&(JsLib.UI.Form.GetType()===JsLib.Enums.FormType.CREATE?JsLib.UI.Form.OpenFormNewRecord(JsLib.Record.GetEntityName(),!1,!1,o(),e.getId().toLowerCase()):JsLib.UI.Form.IsDirty()?JsLib.Record.Save(void 0,function(){e.navigate()},function(){}):e.navigate())})})},t=function(e,o){if(JsLib.Helper.IsNullOrUndefined(e.settings))throw fmfi.JsComponents.Helpers.Common.CreateError("settings missing or empty from the Settings JSON",o);for(let[i,t]of(JsLib.Helper.IsNullOrUndefined(e.switchIfNewForm)&&(e.switchIfNewForm=!0),Object.entries(e.settings))){if(JsLib.Helper.IsNullOrUndefined(t))throw fmfi.JsComponents.Helpers.Common.CreateError("Form GUID is empty or invalid in the Settings JSON",o);e.settings[i]=JsLib.Helper.RemoveParenthesisFromGUID(t.toString()).toLowerCase()}},n=async function(e){if(!e.switchIfNewForm&&JsLib.UI.Form.GetType()===JsLib.Enums.FormType.CREATE)return;let i=JsLib.UI.BPF.GetActiveProcess(),t=JsLib.UI.Form.GetCurrentForm(),n=!JsLib.Helper.IsNullOrUndefined(i)&&i.getId()?i.getId().toLowerCase():"null",r=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(e.settings[n]),s=r.some(e=>e===t.getId().toLowerCase());if(s)return!1;JsLib.UI.Form.GetCurrentEntityAllForms().forEach(function(e){let i=r.some(o=>o===e.getId().toLowerCase());i&&(JsLib.UI.Form.GetType()===JsLib.Enums.FormType.CREATE?JsLib.UI.Form.OpenFormNewRecord(JsLib.Record.GetEntityName(),!1,!1,o(),e.getId().toLowerCase()):JsLib.UI.Form.IsDirty()?JsLib.Record.Save(void 0,function(){e.navigate()},function(){}):e.navigate())})};return{BasedOnFieldValue:{OnLoad:async function(o,t){let n={name:"FormSwitch.BasedOnFieldValue",JSONModel:'{"sourceField": "FIELD_SCHEMA_NAME", "fieldSettings": {"FIELD_VALUE": ["FORM_GUID"], "FIELD_VALUE": ["FORM_GUID"]}, "switchIfNewForm": true}'};if(!o)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',n);if(executionContext=o,!t)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',n);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();let r=fmfi.JsComponents.Helpers.Common.ParseSettings(t,n.JSONModel);e(r,n),JsLib.UI.Listeners.Field.RegisterOnChangeEvent(r.sourceField,function(){i(r)}),await i(r)}},BasedOnBPF:{OnLoad:async function(e,o){let i={name:"FormSwitch.BasedOnBPF",JSONModel:'{"settings": {"BPF_GUID": ["FORM_GUID"], "BPF_GUID": ["FORM_GUID"]}, "switchIfNewForm": true}'};if(!e)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',i);if(executionContext=e,!o)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',i);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();let r=fmfi.JsComponents.Helpers.Common.ParseSettings(o,i.JSONModel);t(r,i),await n(r)}}}}(),fmfi.JsComponents.BPFSwitch=fmfi.JsComponents.BPFSwitch||function(){let e={name:"BPFSwitch",JSONModel:'{"sourceField": "FIELD_SCHEMA_NAME", "fieldSettings": {"FIELD_VALUE": "BPF_GUID", "FIELD_VALUE": "BPF_GUID"}, "showIfValueNotInSettings": false}'},o=function(o){if(JsLib.Helper.IsNullOrUndefined(o.sourceField))throw fmfi.JsComponents.Helpers.Common.CreateError("sourceField missing from the Settings JSON",e);if(JsLib.Helper.IsNullOrUndefined(o.fieldSettings))throw fmfi.JsComponents.Helpers.Common.CreateError("fieldSettings missing or empty from the Settings JSON",e);for(let[i,t]of(JsLib.Helper.IsNullOrUndefined(o.showIfValueNotInSettings)&&(o.showIfValueNotInSettings=!1),Object.entries(o.fieldSettings))){if(JsLib.Helper.IsNullOrUndefined(t))throw fmfi.JsComponents.Helpers.Common.CreateError("BPF GUID is empty or invalid in the Settings JSON",e);o.fieldSettings[i]=JsLib.Helper.RemoveParenthesisFromGUID(t.toString()).toLowerCase()}},i=async function(e){if(JsLib.UI.BPF.SetVisibility(!1),JsLib.UI.Form.GetType()===JsLib.Enums.FormType.CREATE)return;let o=JsLib.UI.BPF.GetActiveProcess(),i=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(JsLib.UI.Field.GetValue(e.sourceField)),t=!1;i.every(function(i){return(i=0!==i.length?i:"null",!JsLib.Helper.IsNullOrUndefined(e.fieldSettings[i])&&(JsLib.Helper.IsNullOrUndefined(o)||!o.getId()||o.getId().toLowerCase()!==e.fieldSettings[i]))?(JsLib.UI.Form.IsDirty()?JsLib.Record.Save(void 0,function(){JsLib.UI.BPF.SetActiveProcess(e.fieldSettings[i])},function(){}):JsLib.UI.BPF.SetActiveProcess(e.fieldSettings[i]),t=!0,!1):JsLib.Helper.IsNullOrUndefined(e.fieldSettings[i])||JsLib.Helper.IsNullOrUndefined(o)||o.getId()&&o.getId().toLowerCase()!==e.fieldSettings[i]?void 0:(t=!0,!1)}),!JsLib.UI.BPF.IsVisible()&&(t||e.showIfValueNotInSettings)&&JsLib.UI.BPF.SetVisibility(!0)};return{BasedOnFieldValue:{OnLoad:async function(t,n){if(!t)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',e);if(executionContext=t,!n)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',e);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();let r=fmfi.JsComponents.Helpers.Common.ParseSettings(n,e.JSONModel);o(r),JsLib.UI.Listeners.Field.RegisterOnChangeEvent(r.sourceField,function(){i(r)}),await i(r)}}}}(),fmfi.JsComponents.CopyFieldValue=fmfi.JsComponents.CopyFieldValue||function(){let e={name:"CopyFieldValue",JSONModel:'[{"sourceField":"FIELD_SCHEMA_NAME", "fieldSettings": [{"sourceField": "FIELD_API_NAME",  "targetField": "FIELD_SCHEMA_NAME", "fireOnChange": true, "overwriteValue": true}]}]'},o=function(o){if(JsLib.Helper.IsNullOrUndefined(o.sourceField))throw fmfi.JsComponents.Helpers.Common.CreateError("sourceField missing from the Settings JSON",e);if(JsLib.Helper.IsNullOrUndefined(o.fieldSettings)||o.fieldSettings.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError("fieldSettings missing or empty the from Settings JSON",e);o.fieldSettings.forEach(function(o){if(JsLib.Helper.IsNullOrUndefined(o.sourceField))throw fmfi.JsComponents.Helpers.Common.CreateError("fieldSettings.sourceField missing or empty from the Settings JSON",e);if(JsLib.Helper.IsNullOrUndefined(o.targetField))throw fmfi.JsComponents.Helpers.Common.CreateError("fieldSettings.targetField missing or empty from Settings the JSON",e);JsLib.Helper.IsNullOrUndefined(o.overwriteValue)&&(o.overwriteValue=!0),JsLib.Helper.IsNullOrUndefined(o.fireOnChange)&&(o.fireOnChange=!0)})},i=async function(o){let i=o.sourceField,t=o.fieldSettings,n=JsLib.UI.Field.GetValue(i),r;n&&(r=await JsLib.WebAPI.CRUD.RetrieveByIDSync(n[0].entityType,n[0].id,"?$select="+t.map(e=>e.sourceField).toString()).catch(o=>{fmfi.JsComponents.Helpers.Common.ShowError(o,e.name)})),t.forEach(function(e){let o=e.sourceField,i=e.targetField,t=e.overwriteValue,n=JsLib.UI.Field.GetValue(i);if(JsLib.Helper.IsNullOrUndefined(n)||t){if((JsLib.Helper.IsNullOrUndefined(r)||JsLib.Helper.IsNullOrUndefined(r[o]))&&JsLib.UI.Form.GetType()!==JsLib.Enums.FormType.CREATE){JsLib.UI.Field.SetValue(i,null);return}!(JsLib.Helper.IsNullOrUndefined(r)||JsLib.Helper.IsNullOrUndefined(r[o]))&&(JsLib.Helper.IsNullOrUndefined(r[o+"@Microsoft.Dynamics.CRM.lookuplogicalname"])?JsLib.UI.Field.SetValue(i,r[o]):JsLib.UI.Field.SetLookupValue(i,r[o+"@Microsoft.Dynamics.CRM.lookuplogicalname"],r[o],r[o+"@OData.Community.Display.V1.FormattedValue"]),e.fireOnChange&&JsLib.UI.Field.TriggerOnChange(i))}})};return{FromRelatedTable:{OnLoad:async function(t,n){if(!t)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',e);if(executionContext=t,!n)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',e);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();fmfi.JsComponents.Helpers.Common.ParseSettings(n,e.JSONModel).forEach(function(t){o(t),JsLib.UI.Listeners.Field.RegisterOnChangeEvent(t.sourceField,function(){i(t).catch(o=>{fmfi.JsComponents.Helpers.Common.ShowError(o,e.name,e.JSONModel)})}),JsLib.UI.Form.GetType()===JsLib.Enums.FormType.CREATE&&i(t).catch(o=>{fmfi.JsComponents.Helpers.Common.ShowError(o,e.name,e.JSONModel)})})}}}}(),fmfi.JsComponents.FormTabAndSectionVisibility=fmfi.JsComponents.FormTabAndSectionVisibility||function(){let e={name:"FormTabAndSectionVisibility",JSONModel:'[{"sourceField":"FIELD_SCHEMA_NAME", "fieldSettings":  [{"fieldValues": ["FIELD_VALUE"], "reverseValues": false, "showSettings": [{"tabName": "TAB_NAME" , "sectionNames": []},{"tabName": "TAB_NAME" , "sectionNames": ["SECTION_NAME1", "SECTION_NAME2"]}]}] }]'},o=function(o){if(JsLib.Helper.IsNullOrUndefined(o.sourceField))throw fmfi.JsComponents.Helpers.Common.CreateError("sourceField missing from Settings the JSON",e);if(JsLib.Helper.IsNullOrUndefined(o.fieldSettings)||o.fieldSettings.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError(o.sourceField+" fieldSettings parameter is missing or empty from the Settings JSON",e);o.fieldSettings.forEach(function(i){if(JsLib.Helper.IsNullOrUndefined(i.fieldValues)||i.fieldValues.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError(o.sourceField+" fieldValues parameter is missing or empty from the Settings JSON",e);if(i.fieldValues=i.fieldValues.map(e=>JsLib.Helper.IsNullOrUndefined(e)?"":JsLib.Helper.RemoveParenthesisFromGUID(e.toString()).toLowerCase()),JsLib.Helper.IsNullOrUndefined(i.showSettings))throw fmfi.JsComponents.Helpers.Common.CreateError(o.sourceField+" showSettings parameter is missing or empty from the Settings JSON",e);JsLib.Helper.IsNullOrUndefined(i.reverseValues)&&(i.reverseValues=!1),i.showSettings.forEach(function(i){if(JsLib.Helper.IsNullOrUndefined(i.tabName))throw fmfi.JsComponents.Helpers.Common.CreateError(o.sourceField+" tabName parameter is missing or empty from the Settings JSON",e);JsLib.Helper.IsNullOrUndefined(i.sectionNames)&&(i.sectionNames=[])})})},i=function(e){let o=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(JsLib.UI.Field.GetValue(e.sourceField)),i=[],t=[],n=[],r=[];e.fieldSettings.forEach(function(e){let s=e.fieldValues,l=e.reverseValues,a=l?!s.some(e=>o.includes(e)):s.some(e=>o.includes(e));e.showSettings.forEach(function(e){let o=e.tabName;a?i.push(o):0===e.sectionNames.length&&t.push(o),e.sectionNames.forEach(function(e){let i={sectionName:e,tabName:o};a?n.push(i):r.push(i)})})}),t=t.filter(function(e){return!i.includes(e)}),i.forEach(function(e){JsLib.UI.Tab.SetVisibility(e,!0)}),t.forEach(function(e){JsLib.UI.Tab.SetVisibility(e,!1)}),r=r.filter(function(e){return!n.some(o=>o.tabName===e.tabName&&o.sectionName===e.sectionName)}),n.forEach(function(e){JsLib.UI.Section.SetVisibility(e.tabName,e.sectionName,!0)}),r.forEach(function(e){JsLib.UI.Section.SetVisibility(e.tabName,e.sectionName,!1)})};return{BasedOnFieldValue:{OnLoad:async function(t,n){if(!t)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',e);if(executionContext=t,!n)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',e);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();fmfi.JsComponents.Helpers.Common.ParseSettings(n,e.JSONModel).forEach(function(e){o(e),JsLib.UI.Listeners.Field.RegisterOnChangeEvent(e.sourceField,function(){i(e)}),i(e)})}}}}(),fmfi.JsComponents.FieldHelpers=fmfi.JsComponents.FieldHelpers||function(){let e=function(e){JsLib.UI.Field.SetSubmitMode(e,JsLib.Enums.Field_SubmitModes.ALWAYS),JsLib.Record.Save(void 0,function(){JsLib.UI.Field.SetSubmitMode(e,JsLib.Enums.Field_SubmitModes.DIRTY)},function(){})},o=function(e){let o=[],i=[];e.fieldSettings.forEach(function(t){let n=t.fieldValues,r=t.reverseValues,s=!0;if(!JsLib.Helper.IsNullOrUndefined(e.sourceField)){let l=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(JsLib.UI.Field.GetValue(e.sourceField));s=r?!n.some(e=>l.includes(e)):n.some(e=>l.includes(e))}t.targetFields.forEach(function(e){s?o.push(e):i.push(e)})}),(o=o.filter(function(e){return!i.includes(e)})).forEach(function(e){JsLib.UI.Field.GetField(e,!1)?.controls.forEach(function(e){e.setDisabled(!0)})}),i.forEach(function(e){JsLib.UI.Field.GetField(e,!1)?.controls.forEach(function(e){e.setDisabled(!1)})})},i=function(e){let o=[],i=[];e.fieldSettings.forEach(function(t){let n=t.fieldValues,r=t.reverseValues,s=!0;if(!JsLib.Helper.IsNullOrUndefined(e.sourceField)){let l=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(JsLib.UI.Field.GetValue(e.sourceField));s=r?!n.some(e=>l.includes(e)):n.some(e=>l.includes(e))}t.targetFields.forEach(function(e){s?o.push(e):i.push(e)})}),(o=o.filter(function(e){return!i.includes(e)})).forEach(function(e){JsLib.UI.Field.GetField(e,!1)?.controls.forEach(function(e){e.setVisible(!1)})}),i.forEach(function(e){JsLib.UI.Field.GetField(e,!1)?.controls.forEach(function(e){e.setVisible(!0)})})},t=function(e){let o=[],i=[];e.fieldSettings.forEach(function(t){let n=t.fieldValues,r=t.reverseValues,s=!0;if(!JsLib.Helper.IsNullOrUndefined(e.sourceField)){let l=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(JsLib.UI.Field.GetValue(e.sourceField));s=r?!n.some(e=>l.includes(e)):n.some(e=>l.includes(e))}t.targetFields.forEach(function(e){s?o.push(e):i.push(e)})}),(o=o.filter(function(e){return!i.includes(e)})).forEach(function(e){JsLib.UI.Field.SetRequirementLevel(e,JsLib.Enums.FieldRequirement_Level.REQUIRED)}),i.forEach(function(e){JsLib.UI.Field.SetRequirementLevel(e,JsLib.Enums.FieldRequirement_Level.NONE)})},n=async function(e){JsLib.UI.Field.SetSubmitMode(e.targetField,JsLib.Enums.Field_SubmitModes.ALWAYS),JsLib.Record.Save(void 0,function(){JsLib.UI.CustomPage.OpenFromFormRibbon(JsLib.Record.GetEntityName(),JsLib.Record.GetId(),e.customPage,e.customPageType),JsLib.UI.Field.SetSubmitMode(e.targetField,JsLib.Enums.Field_SubmitModes.DIRTY)},function(){})};return{AutoSaveOnChange:{OnLoad:async function(o,i){let t={name:"FieldHelpers.AutoSaveOnChange",JSONModel:'["FIELD_SCHEMA_NAME"]'},n=function(e){if(JsLib.Helper.IsNullOrUndefined(e))throw fmfi.JsComponents.Helpers.Common.CreateError("fieldSchemaNames missing from Settings the JSON",t)};if(!o)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',t);if(executionContext=o,!i)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',t);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();fmfi.JsComponents.Helpers.Common.ParseSettings(i,t.JSONModel).forEach(function(o){n(o),JsLib.UI.Listeners.Field.RegisterOnChangeEvent(o,function(){e(o)})})}},LockFields:{OnLoad:async function(e,i){let t={name:"FieldHelpers.LockFields",JSONModel:'[{"sourceField":"FIELD_SCHEMA_NAME", "fieldSettings":  [{"fieldValues": ["FIELD_VALUE"], "reverseValues": false, "targetFields": ["FIELD_SCHEMA_NAME"] }] }]'},n=function(e){if(JsLib.Helper.IsNullOrUndefined(e.fieldSettings)||e.fieldSettings.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError(e.sourceField+" fieldSettings parameter is missing or empty from the Settings JSON",t);e.fieldSettings.forEach(function(o){if(!JsLib.Helper.IsNullOrUndefined(o.fieldValues)&&o.fieldValues.length>=0&&(o.fieldValues=o.fieldValues.map(e=>JsLib.Helper.IsNullOrUndefined(e)?"":JsLib.Helper.RemoveParenthesisFromGUID(e.toString()).toLowerCase())),JsLib.Helper.IsNullOrUndefined(o.targetFields)||o.targetFields.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError(e.sourceField+" targetFields array is missing or empty from the Settings JSON",t);JsLib.Helper.IsNullOrUndefined(o.reverseValues)&&(o.reverseValues=!1)})};if(!e)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',t);if(executionContext=e,!i)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',t);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();fmfi.JsComponents.Helpers.Common.ParseSettings(i,t.JSONModel).forEach(function(e){n(e),JsLib.Helper.IsNullOrUndefined(e.sourceField)||JsLib.UI.Listeners.Field.RegisterOnChangeEvent(e.sourceField,function(){o(e)}),o(e)})}},HideOrUnhideFields:{OnLoad:async function(e,o){let t={name:"FieldHelpers.HideOrUnhideFields",JSONModel:'[{"sourceField":"FIELD_SCHEMA_NAME", "fieldSettings":  [{"fieldValues": ["FIELD_VALUE"], "reverseValues": false, "targetFields": ["FIELD_SCHEMA_NAME"] }] }]'},n=function(e){if(JsLib.Helper.IsNullOrUndefined(e.fieldSettings)||e.fieldSettings.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError(e.sourceField+" fieldSettings parameter is missing or empty from the Settings JSON",t);e.fieldSettings.forEach(function(o){if(!JsLib.Helper.IsNullOrUndefined(o.fieldValues)&&o.fieldValues.length>=0&&(o.fieldValues=o.fieldValues.map(e=>JsLib.Helper.IsNullOrUndefined(e)?"":JsLib.Helper.RemoveParenthesisFromGUID(e.toString()).toLowerCase())),JsLib.Helper.IsNullOrUndefined(o.targetFields)||o.targetFields.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError(e.sourceField+" targetFields array is missing or empty from the Settings JSON",t);JsLib.Helper.IsNullOrUndefined(o.reverseValues)&&(o.reverseValues=!1)})};if(!e)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',t);if(executionContext=e,!o)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',t);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();fmfi.JsComponents.Helpers.Common.ParseSettings(o,t.JSONModel).forEach(function(e){n(e),JsLib.Helper.IsNullOrUndefined(e.sourceField)||JsLib.UI.Listeners.Field.RegisterOnChangeEvent(e.sourceField,function(){i(e)}),i(e)})}},SetFieldsRequired:{OnLoad:async function(e,o){let i={name:"FieldHelpers.SetFieldsRequired",JSONModel:'[{"sourceField":"FIELD_SCHEMA_NAME", "fieldSettings":  [{"fieldValues": ["FIELD_VALUE"], "reverseValues": false, "targetFields": ["FIELD_SCHEMA_NAME"] }] }]'},n=function(e){if(JsLib.Helper.IsNullOrUndefined(e.fieldSettings)||e.fieldSettings.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError(e.sourceField+" fieldSettings parameter is missing or empty from the Settings JSON",i);e.fieldSettings.forEach(function(o){if(!JsLib.Helper.IsNullOrUndefined(o.fieldValues)&&o.fieldValues.length>=0&&(o.fieldValues=o.fieldValues.map(e=>JsLib.Helper.IsNullOrUndefined(e)?"":JsLib.Helper.RemoveParenthesisFromGUID(e.toString()).toLowerCase())),JsLib.Helper.IsNullOrUndefined(o.targetFields)||o.targetFields.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError(e.sourceField+" targetFields array is missing or empty from the Settings JSON",i);JsLib.Helper.IsNullOrUndefined(o.reverseValues)&&(o.reverseValues=!1)})};if(!e)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',i);if(executionContext=e,!o)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',i);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();fmfi.JsComponents.Helpers.Common.ParseSettings(o,i.JSONModel).forEach(function(e){n(e),JsLib.Helper.IsNullOrUndefined(e.sourceField)||JsLib.UI.Listeners.Field.RegisterOnChangeEvent(e.sourceField,function(){t(e)}),t(e)})}},OpenCustomPageOnChange:{OnLoad:async function(e,o){let i={name:"FieldHelpers.OpenCustomPageOnChange",JSONModel:'[{"targetField":"FIELD_SCHEMA_NAME", "customPage": "CUSTOM_PAGE_LOGICAL_NAME", "customPageType": "CUSTOM_PAGE_TYPE"}]'};if(!e)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',i);if(executionContext=e,!o)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',i);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();let t=function(e){if(JsLib.Helper.IsNullOrUndefined(e.targetField))throw fmfi.JsComponents.Helpers.Common.CreateError("targetField missing from Settings the JSON",i);if(JsLib.Helper.IsNullOrUndefined(e.customPage))throw fmfi.JsComponents.Helpers.Common.CreateError("customPage missing from Settings the JSON",i);JsLib.Helper.IsNullOrUndefined(e.customPageType)?e.customPageType=JsLib.Enums.CustomPageType.DIALOG:"dialog"===e.customPageType.toLowerCase()?e.customPageType=JsLib.Enums.CustomPageType.DIALOG:"inline"===e.customPageType.toLowerCase()?e.customPageType=JsLib.Enums.CustomPageType.INLINE:"sidedialog"===e.customPageType.toLowerCase()?e.customPageType=JsLib.Enums.CustomPageType.SIDEDIALOG:e.customPageType=JsLib.Enums.CustomPageType.DIALOG};fmfi.JsComponents.Helpers.Common.ParseSettings(o,i.JSONModel).forEach(function(e){t(e),JsLib.UI.Listeners.Field.RegisterOnChangeEvent(e.targetField,function(){n(e)})})}}}}(),fmfi.JsComponents.ChoiceManipulator=fmfi.JsComponents.ChoiceManipulator||function(){let e={},o=async function(e,o){if(JsLib.Helper.IsNullOrUndefined(e.sourceField))throw fmfi.JsComponents.Helpers.Common.CreateError("sourceField missing from the Settings JSON",o);if(JsLib.Helper.IsNullOrUndefined(e.targetField))throw fmfi.JsComponents.Helpers.Common.CreateError("targetField missing from the Settings JSON",o);if(JsLib.Helper.IsNullOrUndefined(e.fieldSettings)||e.fieldSettings.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError(e.sourceField+" fieldSettings parameter is missing or empty from the Settings JSON",o);JsLib.Helper.IsNullOrUndefined(e.showAlwaysCurrentValue)&&(e.showAlwaysCurrentValue=!0),JsLib.Helper.IsNullOrUndefined(e.clearChildValueOnParentChange)&&(e.clearChildValueOnParentChange=!0),e.fieldSettings.forEach(function(i){if(JsLib.Helper.IsNullOrUndefined(i.fieldValues)||i.fieldValues.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError(e.sourceField+" fieldValues parameter is missing or empty from the Settings JSON",o);if(i.fieldValues=i.fieldValues.map(e=>JsLib.Helper.IsNullOrUndefined(e)?"":JsLib.Helper.RemoveParenthesisFromGUID(e.toString()).toLowerCase()),JsLib.Helper.IsNullOrUndefined(i.choiceValuesToShow)||i.choiceValuesToShow.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError(e.sourceField+" choiceValuesToShow parameter is missing or empty from the Settings JSON",o);i.choiceValuesToShow=i.choiceValuesToShow.map(e=>JsLib.Helper.RemoveParenthesisFromGUID(e.toString()).toLowerCase())})},i=async function(o,i){let t=JsLib.UI.Field.GetField(o.targetField,!0)?.controls;e[o.targetField]?e[o.targetField]&&t.forEach(function(i){i.clearOptions(),e[o.targetField].forEach(function(e){i.addOption(e)})}):e[o.targetField]=JsLib.UI.Optionset.GetOptions(o.targetField),o.fieldSettings.forEach(function(e){let n=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(JsLib.UI.Field.GetValue(o.sourceField));e.fieldValues.some(e=>n.includes(e))&&t.forEach(function(t){let n=JsLib.UI.Optionset.GetOptions(o.targetField),r=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(JsLib.UI.Field.GetValue(o.targetField));n.forEach(function(n){(!(r.length>0&&r.includes(n.value.toString()))||!o.showAlwaysCurrentValue||i&&o.clearChildValueOnParentChange)&&n&&!e.choiceValuesToShow.includes(n.value.toString())&&t.removeOption(n.value)})}),JsLib.UI.Field.GetValue(o.targetField)&&i&&o.clearChildValueOnParentChange&&(JsLib.UI.Field.SetValue(o.targetField,null),JsLib.UI.Field.TriggerOnChange(o.targetField))})},t=async function(e,o){if(JsLib.Helper.IsNullOrUndefined(e.targetField))throw fmfi.JsComponents.Helpers.Common.CreateError("targetField missing from Settings JSON",o);if(JsLib.Helper.IsNullOrUndefined(e.choiceValuesToHide)||e.choiceValuesToHide.length<=0)throw fmfi.JsComponents.Helpers.Common.CreateError(e.targetField+" choiceValuesToHide parameter is missing or empty from Settings JSON",o);e.choiceValuesToHide=e.choiceValuesToHide.map(e=>JsLib.Helper.RemoveParenthesisFromGUID(e.toString()).toLowerCase())},n=async function(e){let o=JsLib.UI.Field.GetField(e.targetField,!0)?.controls;o.forEach(function(o){e.choiceValuesToHide.forEach(function(i){let t=fmfi.JsComponents.Helpers.Common.ConvertFieldValueToStringArray(JsLib.UI.Field.GetValue(e.targetField));i&&(0===t.length||!t.includes(i.toString()))&&o.removeOption(Number(i))})})};return{HideChoiceValuesIfNotCurrentValue:{OnLoad:async function(e,o){let i={name:"ChoiceManipulator.HideChoiceValuesIfNotCurrentValue",JSONModel:'[{"targetField":"FIELD_SCHEMA_NAME", "choiceValuesToHide": ["CHOICE_VALUE"]}]'};if(!e)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',i);if(executionContext=e,!o)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',i);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();fmfi.JsComponents.Helpers.Common.ParseSettings(o,i.JSONModel).forEach(function(e){t(e,i),n(e)})}},ShowChoiceValuesBasedOnFieldValue:{OnLoad:async function(e,t){let n={name:"ChoiceManipulator.ShowChoiceValuesBasedOnFieldValue",JSONModel:'[{"sourceField": "FIELD_SCHEMA_NAME", "targetField":"FIELD_SCHEMA_NAME", "fieldSettings": [{"fieldValues": ["FIELD_VALUE"], "choiceValuesToShow": ["CHOICE_VALUE"]}], "showAlwaysCurrentValue": true, "clearChildValueOnParentChange": true }]'};if(!e)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',n);if(executionContext=e,!t)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',n);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();fmfi.JsComponents.Helpers.Common.ParseSettings(t,n.JSONModel).forEach(function(e){o(e,n),JsLib.UI.Listeners.Field.RegisterOnChangeEvent(e.sourceField,function(){i(e,!0)}),i(e,!1)})}}}}(),fmfi.JsComponents.RunFlow=fmfi.JsComponents.RunFlow||function(){let e,o=function(o,n){JsLib.Helper.ShowProgressBar(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ProgressBar"));let r={userid:JsLib.Helper.RemoveParenthesisFromGUID(JsLib.CurrentUser.GetUserID()),extra:o.extra};JsLib.Helper.IsNullOrUndefined(n)?r.recordid=JsLib.Helper.RemoveParenthesisFromGUID(JsLib.Record.GetId()):r.recordidarray=n.map(({Id:e})=>e),JsLib.Helper.IsNullOrUndefined(e)?r.tablename=JsLib.Record.GetEntityName():r.tablename=e.getEntityName();let s=[{name:"ConfigurationRowName",type:JsLib.Enums.EntityDataModel_PrimitiveType.STRING,value:o.configurationRowName,category:JsLib.Enums.EntityDataModel_StructuralType.PRIMITIVETYPE},{name:"Body",type:JsLib.Enums.EntityDataModel_PrimitiveType.STRING,value:JSON.stringify(r),category:JsLib.Enums.EntityDataModel_StructuralType.PRIMITIVETYPE}];JsLib.Helper.IsNullOrUndefined(o.configurationTable)||s.push({name:"ConfigurationTable",type:JsLib.Enums.EntityDataModel_PrimitiveType.STRING,value:o.configurationTable,category:JsLib.Enums.EntityDataModel_StructuralType.PRIMITIVETYPE}),JsLib.WebAPI.Requests.ExecuteAction("fmfi_ExecuteHttpTriggerPowerAutomateFlow",void 0,void 0,s,function(e){if(JsLib.Helper.IsNullOrUndefined(e)||!e.ok){t(e);return}e.json().then(function(o){let n;if(JsLib.Helper.IsNullOrUndefined(o)||JsLib.Helper.IsNullOrUndefined(o.Message)){t(e);return}try{n=JSON.parse(o.Message)}catch(r){t(r);return}if(JsLib.Helper.IsNullOrUndefined(n)){t(e);return}i(n??{})})},t)},i=function(o){let i=o.success??o.Success??!0,n=o.message??o.Message,r=o.tablename??o.tableName??o.table??o.Table??o.Entity??o.entity,s=o.recordid??o.RowGuid??o.Rowguid??o.rowGuid??o.rowguid??o.recordId??o.recordID;if("False"===i||"false"===i||!1===i){t({message:n??JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.DefaultError")});return}let l=fmfi.JsComponents.Helpers.Common.CalculateDialogDimension(n);JsLib.Helper.CloseProgressBar(),JsLib.Helper.IsNullOrUndefined(n)||JsLib.Helper.IsNullOrUndefined(r)||JsLib.Helper.IsNullOrUndefined(s)?JsLib.Helper.IsNullOrUndefined(r)||JsLib.Helper.IsNullOrUndefined(s)?JsLib.Helper.IsNullOrUndefined(executionContext)?JsLib.Helper.IsNullOrUndefined(e)?(n=n??JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.DefaultSuccess"),JsLib.UI.Dialogue.ShowAlert(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ResponseHeader"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.Ok"),n,l.height,l.width)):(e.refresh(),n=n??JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.DefaultSuccess"),JsLib.UI.Dialogue.ShowAlert(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ResponseHeader"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.Ok"),n,l.height,l.width)):JsLib.UI.Form.Refresh(!1,function(){n=n??JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.DefaultSuccess"),JsLib.UI.Dialogue.ShowAlert(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ResponseHeader"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.Ok"),n,l.height,l.width)},function(){}):JsLib.UI.Form.OpenFormExistingRecord(r,s):JsLib.UI.Dialogue.ShowAlert(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ResponseHeader"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.Ok"),n,l.height,l.width,function(){JsLib.UI.Form.OpenFormExistingRecord(r,s)})},t=function(e){JsLib.Helper.CloseProgressBar(),JsLib.UI.Dialogue.ShowAlert(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.Error"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.Ok"),e.message??e)};return{FormOnFieldValueChange:{OnLoad:async function(e,i){let n={name:"RunFlow.FormOnFieldValueChange",JSONModel:'[{"targetField":"FIELD_SCHEMA_NAME", "configurationTable": "CONFIGURATION_TABLE_NAME", "configurationRowName": "CONFIGURATION_ROW_NAME", "askConfirmation": true , "confirmationText": "CONFIRMATION_TEXT", "extra": "EXTRA"}]'},r=function(e){if(JsLib.Helper.IsNullOrUndefined(e.configurationRowName))throw fmfi.JsComponents.Helpers.Common.CreateError("configurationRowName missing from Settings the JSON",n);JsLib.Helper.IsNullOrUndefined(e.configurationTable)&&(e.configurationTable=null),JsLib.Helper.IsNullOrUndefined(e.confirmationText)&&(e.confirmationText=JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ConfirmationText")),JsLib.Helper.IsNullOrUndefined(e.askConfirmation)&&(e.askConfirmation=!0)};if(!e)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass execution context as first parameter"!',n);if(executionContext=e,!i)throw fmfi.JsComponents.Helpers.Common.CreateError('You must add settings JSON to "Comma separated list of parameters that will be passed to the function"-box!',n);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();fmfi.JsComponents.Helpers.Common.ParseSettings(i,n.JSONModel).forEach(function(e){r(e),JsLib.UI.Listeners.Field.RegisterOnChangeEvent(e.targetField,function(){JsLib.UI.Field.SetSubmitMode(e.targetField,JsLib.Enums.Field_SubmitModes.ALWAYS),JsLib.Record.Save(void 0,function(){if(JsLib.UI.Field.SetSubmitMode(e.targetField,JsLib.Enums.Field_SubmitModes.DIRTY),e.askConfirmation)JsLib.UI.Dialogue.ShowConfirmation(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ConfirmationHeader"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"Yes"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"No"),e.confirmationText,function(i){if(i.confirmed)try{o(e)}catch(n){t(n)}});else try{o(e)}catch(i){t(i)}},function(){})})})}},Ribbon:{FormRunFlow:async function(e,i){let n={name:"RunFlow.FormRunFlow",JSONModel:'{"configurationTable": "CONFIGURATION_TABLE_NAME", "configurationRowName": "CONFIGURATION_ROW_NAME", "askConfirmation": true , "confirmationText": "CONFIRMATION_TEXT", "extra": "EXTRA"}'};if(!(executionContext=e))throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass Primary control as first parameter"!',n);if(!i)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass settings JSON as second parameter!',n);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();let r=fmfi.JsComponents.Helpers.Common.ParseSettings(i,n.JSONModel);(function(e){if(JsLib.Helper.IsNullOrUndefined(e.configurationRowName))throw fmfi.JsComponents.Helpers.Common.CreateError("configurationRowName missing from Settings the JSON",n);JsLib.Helper.IsNullOrUndefined(e.configurationTable)&&(e.configurationTable=null),JsLib.Helper.IsNullOrUndefined(e.confirmationText)&&(e.confirmationText=JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ConfirmationText")),JsLib.Helper.IsNullOrUndefined(e.askConfirmation)&&(e.askConfirmation=!0)})(r),JsLib.Record.Save(void 0,function(){if(r.askConfirmation)JsLib.UI.Dialogue.ShowConfirmation(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ConfirmationHeader"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"Yes"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"No"),r.confirmationText,function(e){if(e.confirmed)try{o(r)}catch(i){t(i)}});else try{o(r)}catch(e){t(e)}},function(){})},SubGridRunFlow:async function(e,i,n){let r={name:"RunFlow.FormRunFlow",JSONModel:'{"configurationTable": "CONFIGURATION_TABLE_NAME", "configurationRowName": "CONFIGURATION_ROW_NAME", "askConfirmation": true , "confirmationText": "CONFIRMATION_TEXT", "extra": "EXTRA"}'};if(!(executionContext=e))throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass primary control as first parameter"!',r);if(!i)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass selectedRecordRefs as second parameter"!',r);if(!n)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass settings JSON as third parameter!',r);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();let s=fmfi.JsComponents.Helpers.Common.ParseSettings(n,r.JSONModel);(function(e){if(JsLib.Helper.IsNullOrUndefined(e.configurationRowName))throw fmfi.JsComponents.Helpers.Common.CreateError("configurationRowName missing from Settings the JSON",r);JsLib.Helper.IsNullOrUndefined(e.configurationTable)&&(e.configurationTable=null),JsLib.Helper.IsNullOrUndefined(e.confirmationText)&&(e.confirmationText=JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ConfirmationText")),JsLib.Helper.IsNullOrUndefined(e.askConfirmation)&&(e.askConfirmation=!0)})(s),JsLib.Record.Save(void 0,function(){if(s.askConfirmation)JsLib.UI.Dialogue.ShowConfirmation(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ConfirmationHeader"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"Yes"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"No"),s.confirmationText,function(e){if(e.confirmed)try{o(s,i)}catch(n){t(n)}});else try{o(s,i)}catch(e){t(e)}},function(){})},GridRunFlow:async function(i,n,r){let s={name:"RunFlow.FormRunFlow",JSONModel:'{"configurationTable": "CONFIGURATION_TABLE_NAME", "configurationRowName": "CONFIGURATION_ROW_NAME", "askConfirmation": true , "confirmationText": "CONFIRMATION_TEXT", "extra": "EXTRA"}'};if(!(e=i))throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass Primary Control as first parameter"!',s);if(!n)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass selectedRecordRefs as second parameter"!',s);if(!r)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass settings JSON as third parameter!',s);JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();let l=fmfi.JsComponents.Helpers.Common.ParseSettings(r,s.JSONModel);if(function(e){if(JsLib.Helper.IsNullOrUndefined(e.configurationRowName))throw fmfi.JsComponents.Helpers.Common.CreateError("configurationRowName missing from Settings the JSON",s);JsLib.Helper.IsNullOrUndefined(e.configurationTable)&&(e.configurationTable=null),JsLib.Helper.IsNullOrUndefined(e.confirmationText)&&(e.confirmationText=JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ConfirmationText")),JsLib.Helper.IsNullOrUndefined(e.askConfirmation)&&(e.askConfirmation=!0)}(l),l.askConfirmation)JsLib.UI.Dialogue.ShowConfirmation(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"RunFlow.ConfirmationHeader"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"Yes"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"No"),l.confirmationText,function(e){if(e.confirmed)try{o(l,n)}catch(i){t(i)}});else try{o(l,n)}catch(a){t(a)}}}}}(),fmfi.JsComponents.CreateCopyOfTheRow=fmfi.JsComponents.CreateCopyOfTheRow||function(){let e,o=async function(e,o,i){let t={},n=await JsLib.WebAPI.CRUD.RetrieveByIDSync(e,JsLib.Helper.RemoveParenthesisFromGUID(o)),r=await JsLib.Context.GetEntityMetadata(e);if(n&&r&&r.value&&r.value.length>0&&r.value[0].Attributes)for(let[s,l]of Object.entries(n)){if(s.includes("@")||!l)continue;let a=s.startsWith("_")&&s.endsWith("_value")?s.substring(1,s.length-6):s;if(i.ignoreFields.includes(a))continue;let m=r.value[0].Attributes.find(e=>e.LogicalName===a);if(m&&!0===m.IsValidForCreate&&!m.AutoNumberFormat&&"Uniqueidentifier"!==m.AttributeType&&"Status"!==m.AttributeType){if("Lookup"===m.AttributeType||"Owner"===m.AttributeType||"Customer"===m.AttributeType){let f=[{id:l,name:n[s+"@OData.Community.Display.V1.FormattedValue"],entityType:n[s+"@Microsoft.Dynamics.CRM.lookuplogicalname"]}];t[a]=f}else t[s]=l}}return t};return{Ribbon:{FormCreateDraftCopy:async function(e,i){var t;let n={name:"CreateCopyOfTheRow.FormCreateDraftCopy",JSONModel:'{"ignoreFields": ["FIELDSCHEMANAME"], "askConfirmation": true , "confirmationText": "CONFIRMATION_TEXT", "formId": "FORMGUID", "useQuickCreateForm": false }'};if(!(executionContext=e))throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass Primary control as first parameter"!',n);i||(i="{}"),JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();let r=fmfi.JsComponents.Helpers.Common.ParseSettings(i,n.JSONModel);t=r,JsLib.Helper.IsNullOrUndefined(t.ignoreFields)&&(t.ignoreFields=[]),JsLib.Helper.IsNullOrUndefined(t.confirmationText)&&(t.confirmationText=JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"CreateCopyOfTheRow.ConfirmationText")),JsLib.Helper.IsNullOrUndefined(t.askConfirmation)&&(t.askConfirmation=!0),JsLib.Helper.IsNullOrUndefined(t.useQuickCreateForm)&&(t.useQuickCreateForm=!1),JsLib.Helper.IsNullOrUndefined(t.formId)||(t.formId=JsLib.Helper.RemoveParenthesisFromGUID(t.formId).toLowerCase()),JsLib.Record.Save(void 0,async function(){r.askConfirmation?JsLib.UI.Dialogue.ShowConfirmation(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"CreateCopyOfTheRow.ConfirmationHeader"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"Yes"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"No"),r.confirmationText,async function(e){e.confirmed&&JsLib.UI.Form.OpenFormNewRecord(JsLib.Record.GetEntityName(),r.useQuickCreateForm,!1,await o(JsLib.Record.GetEntityName(),JsLib.Record.GetId(!0),r),r.formId)}):JsLib.UI.Form.OpenFormNewRecord(JsLib.Record.GetEntityName(),r.useQuickCreateForm,!1,await o(JsLib.Record.GetEntityName(),JsLib.Record.GetId(!0),r),r.formId)},function(){})},SubGridCreateDraftCopy:async function(e,i,t){var n;let r={name:"CreateCopyOfTheRow.SubGridCreateDraftCopy",JSONModel:'{"ignoreFields": ["FIELDSCHEMANAME"], "askConfirmation": true , "confirmationText": "CONFIRMATION_TEXT", "formId": "FORMGUID", "useQuickCreateForm": false }'};if(!(executionContext=e))throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass primary control as first parameter"!',r);if(!i)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass selectedRecordRefs as second parameter"!',r);if(1!==i.length)throw fmfi.JsComponents.Helpers.Common.CreateError('You must select only one row"!',r);t||(t="{}"),JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();let s=fmfi.JsComponents.Helpers.Common.ParseSettings(t,r.JSONModel);n=s,JsLib.Helper.IsNullOrUndefined(n.ignoreFields)&&(n.ignoreFields=[]),JsLib.Helper.IsNullOrUndefined(n.confirmationText)&&(n.confirmationText=JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"CreateCopyOfTheRow.ConfirmationText")),JsLib.Helper.IsNullOrUndefined(n.askConfirmation)&&(n.askConfirmation=!0),JsLib.Helper.IsNullOrUndefined(n.useQuickCreateForm)&&(n.useQuickCreateForm=!1),JsLib.Helper.IsNullOrUndefined(n.formId)||(n.formId=JsLib.Helper.RemoveParenthesisFromGUID(n.formId).toLowerCase()),JsLib.Record.Save(void 0,async function(){s.askConfirmation?JsLib.UI.Dialogue.ShowConfirmation(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"CreateCopyOfTheRow.ConfirmationHeader"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"Yes"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"No"),s.confirmationText,async function(e){e.confirmed&&JsLib.UI.Form.OpenFormNewRecord(i[0].TypeName,s.useQuickCreateForm,!1,await o(i[0].TypeName,i[0].Id,s),s.formId)}):JsLib.UI.Form.OpenFormNewRecord(i[0].TypeName,s.useQuickCreateForm,!1,await o(i[0].TypeName,i[0].Id,s),s.formId)},function(){})},GridCreateDraftCopy:async function(i,t,n){var r;let s={name:"CreateCopyOfTheRow.GridCreateDraftCopy",JSONModel:'{"ignoreFields": ["FIELDSCHEMANAME"], "askConfirmation": true , "confirmationText": "CONFIRMATION_TEXT", "formId": "FORMGUID", "useQuickCreateForm": false }'};if(!(e=i))throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass Primary Control as first parameter"!',s);if(!t)throw fmfi.JsComponents.Helpers.Common.CreateError('You must "Pass selectedRecordRefs as second parameter"!',s);if(1!==t.length)throw fmfi.JsComponents.Helpers.Common.CreateError('You must select only one row"!',s);n||(n="{}"),JsLib||await fmfi.JsComponents.Helpers.JSLIBLoader.Load();let l=fmfi.JsComponents.Helpers.Common.ParseSettings(n,s.JSONModel);r=l,JsLib.Helper.IsNullOrUndefined(r.ignoreFields)&&(r.ignoreFields=[]),JsLib.Helper.IsNullOrUndefined(r.confirmationText)&&(r.confirmationText=JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"CreateCopyOfTheRow.ConfirmationText")),JsLib.Helper.IsNullOrUndefined(r.askConfirmation)&&(r.askConfirmation=!0),JsLib.Helper.IsNullOrUndefined(r.useQuickCreateForm)&&(r.useQuickCreateForm=!1),JsLib.Helper.IsNullOrUndefined(r.formId)||(r.formId=JsLib.Helper.RemoveParenthesisFromGUID(r.formId).toLowerCase()),l.askConfirmation?JsLib.UI.Dialogue.ShowConfirmation(JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"CreateCopyOfTheRow.ConfirmationHeader"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"Yes"),JsLib.Helper.GetWebresourceLocalizedString(fmfi.JsComponents._LocalizationFileName,"No"),l.confirmationText,async function(e){e.confirmed&&JsLib.UI.Form.OpenFormNewRecord(t[0].TypeName,l.useQuickCreateForm,!1,await o(t[0].TypeName,t[0].Id,l),l.formId)}):JsLib.UI.Form.OpenFormNewRecord(t[0].TypeName,l.useQuickCreateForm,!1,await o(t[0].TypeName,t[0].Id,l),l.formId)}}}}();